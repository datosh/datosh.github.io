<!doctype html><html dir=ltr lang=en data-theme class="html theme--light"><head><meta charset=utf-8><title>DaTosh
|
Traefik 2 as Docker Reverse Proxy on unRAID
</title><meta name=generator content="Hugo 0.126.1"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="DaTosh"><meta name=description content="Setting up Traefik 2.x as Reverse Proxy for Docker Containers on unRAID 6.8.x"><link rel=stylesheet href=/scss/main.min.c80d3a01d275af845c9127eb8957e4707b6f08256c1d3a46878770a63fec205a.css integrity="sha256-yA06AdJ1r4RckSfriVfkcHtvCCVsHTpGh4dwpj/sIFo=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=https://datosh.github.io/post/unraid_reverse_traefik/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script><script type=text/javascript src=/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Traefik 2 as Docker Reverse Proxy on unRAID"><meta name=twitter:description content="Setting up Traefik 2.x as Reverse Proxy for Docker Containers on unRAID 6.8.x"><meta property="og:url" content="https://datosh.github.io/post/unraid_reverse_traefik/"><meta property="og:site_name" content="DaTosh Blog"><meta property="og:title" content="Traefik 2 as Docker Reverse Proxy on unRAID"><meta property="og:description" content="Setting up Traefik 2.x as Reverse Proxy for Docker Containers on unRAID 6.8.x"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-01-23T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-23T00:00:00+00:00"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Traefik"><meta property="article:tag" content="Unraid"><meta property="article:tag" content="Reverse Proxy"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"post","name":"Traefik 2 as Docker Reverse Proxy on unRAID","headline":"Traefik 2 as Docker Reverse Proxy on unRAID","alternativeHeadline":"","description":"
      Setting up Traefik 2.x as Reverse Proxy for Docker Containers on unRAID 6.8.x


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/datosh.github.io\/post\/unraid_reverse_traefik\/"},"author":{"@type":"Person","name":"DaTosh"},"creator":{"@type":"Person","name":"DaTosh"},"accountablePerson":{"@type":"Person","name":"DaTosh"},"copyrightHolder":{"@type":"Person","name":"DaTosh"},"copyrightYear":"2021","dateCreated":"2021-01-23T00:00:00.00Z","datePublished":"2021-01-23T00:00:00.00Z","dateModified":"2021-01-23T00:00:00.00Z","publisher":{"@type":"Organization","name":"DaTosh","url":"https://datosh.github.io/","logo":{"@type":"ImageObject","url":"https:\/\/datosh.github.io\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/datosh.github.io\/post\/unraid_reverse_traefik\/","wordCount":"550","genre":[],"keywords":["docker","traefik","unraid","reverse proxy"]}</script></head><body class=body><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
."><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/images/Profile.jpg alt="profile picture"><div class=sidebar__introduction-title><a href=/>DaTosh Blog</a></div><div class=sidebar__introduction-description><p></p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://github.com/datosh target=_blank rel="noopener me" aria-label=GitHub title=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/datosh18 target=_blank rel="noopener me" aria-label=twitter title=twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.linkedin.com/in/fabian-kammel-7781b7173/ target=_blank rel="noopener me" aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
DaTosh
2024</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class=.><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/ title>Home</a></li><li class=nav__list-item><a href=/post/ title>Posts</a></li><li class=nav__list-item><a href=/goinvaders/game.html title>goinvaders</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
."><div class=post__content><h1>Traefik 2 as Docker Reverse Proxy on UnRAID</h1><ul class=post__meta><li class=post__meta-item><em class="fas fa-calendar-day post__meta-icon"></em>
<span class=post__meta-text>Sat, Jan 23, 2021</span></li><li class=post__meta-item><em class="fas fa-stopwatch post__meta-icon"></em>
<span class=post__meta-text>3-minute read</span></li></ul><p>Hosting multiple containers on unRAID, and keeping track of their port mappings
can become quite annoying. Using a reverse proxy as a single point of entry
will allow us to hide this from the user, and use easy to remember DNS records
instead.</p><p>In this example we will use Traefik 2.x as a reverse proxy on an unRAID 6.8.x
machine, and configure easy access to the unRAID webUI, Traefik dashboard, as
well as an example Wordpress container, to show how traffic can be routed to
any container running on unRAID.</p><h2 id=configure-dns-records>Configure DNS Records</h2><p>First we need to create three DNS records, all pointing to the box unRAID is
running on. In this example we assume the TLD <code>home</code>, and unRAID
running on <code>192.168.1.10</code>.</p><ul><li><code>unraid.home</code> → <code>192.168.1.10</code></li><li><code>traefik.home</code> → <code>192.168.1.10</code></li><li><code>wordpress.home</code> → <code>192.168.1.10</code></li></ul><p>How and where to configure these depends on the DNS server you are using.</p><h2 id=reconfigure-unraids-http-port>Reconfigure unRAID&rsquo;s HTTP Port</h2><p>Traefik will be listening on port <code>80</code> and we need to free up this port,
since unRAID&rsquo;s WebUI will be using it by default.</p><p>Go to <code>Settings → Management Access</code>, and change <code>HTTP port</code>.
Here we will be using <code>HTTP port: 8085</code>.</p><p><strong>In case your Traefik container is broken, you can always access your
unRAID server at <code>http://192.168.1.10:8085</code>.</strong></p><h2 id=prepare-traefik-configuration>Prepare Traefik Configuration</h2><p>In order to configure Trafik we will be using a mix of dynamic configuration
(via Docker labels), and static configuration (via configuration files).</p><p>Place the following configuration files in your <code>appdata</code> share.</p><p><strong><code>appdata/traefik/traefik.yml</code></strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#204a87;font-weight:700>api</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>dashboard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>insecure</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>entryPoints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;:80&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>providers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>docker</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>filename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/traefik/dynamic_conf.yml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>watch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong><code>appdata/traefik/dynamic_conf.yml</code></strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>routers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>unraid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>entryPoints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>http</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>service</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>unraid</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rule</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Host(`unraid.home`)&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>unraid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>loadBalancer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>servers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;http://192.168.1.10:8085/&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=launch-traefik-container>Launch Traefik Container</h2><p>Now we can launch the actual Traefik container. Go to the <code>Docker</code> tab
in unRAID and <code>ADD CONTAINER</code>.<br>We need to fill in the following configuration:</p><p>Name: <code>traefik</code><br>Repository: <code>traefik:latest</code><br>Network Type: <code>bridge</code></p><p>Add a <strong>port</strong> mapping from <code>80 → 80</code>, so that Traefik can listen for incoming
HTTP traffic.</p><p>Add a <strong>path</strong> where we mount our <code>/mnt/user/appdata/traefik</code> to <code>/etc/traefik</code>
so that Traefik can actually read our configuration.</p><p>Add another <strong>path</strong> where we mount our Docker socket <code>/var/run/docker.sock</code>
to <code>/var/run/docker.sock</code>. <strong>Read-only</strong> is sufficient here. This is required
so Traefik can listed for new containers and read their labels, which is used
for the dynamic configuration part. We are using this exact mechanism to expose
the Treafik dashboard now.</p><p>Add a <strong>label</strong></p><ul><li><strong>key</strong> = <code>traefik.http.routers.api.entrypoints</code></li><li><strong>value</strong> = <code>http</code></li></ul><p>Add another <strong>label</strong></p><ul><li><strong>key</strong> = <code>traefik.http.routers.api.service</code></li><li><strong>value</strong> = <code>api@internal</code></li></ul><p>And a final <strong>label</strong></p><ul><li><strong>key</strong> = <code>traefik.http.routers.api.rule</code></li><li><strong>value</strong> = Host(`traefik.home`)</li></ul><p>Your container configuration should look like
<a href=https://i.imgur.com/206isoD.png>this</a></p><p>After creating the container you are now able to access unRAID at
<a href=http://unraid.home>http://unraid.home</a>, and the
Traefik dashboard at <a href=http://traefik.home>http://traefik.home</a>.</p><h2 id=proxying-any-container>Proxying any Container</h2><p>In order to add another container to our Traefik configuration we simply need
to add a single label to it.</p><p>Assuming we have a Wordpress container running we can add a <strong>label</strong> with</p><ul><li><strong>key</strong> = <code>traefik.http.routers.wordpress.rule</code></li><li><strong>value</strong> = Host(`wordpress.home`)</li></ul><p>If our container is only exposing a single port,
<a href=https://doc.traefik.io/traefik/providers/docker/#port-detection>Traefik is smart enough to pick it up,</a>
and no other configuration is required.</p><p>If our Wordpress container would expose multiple ports, but the webUI is
accessible on port 8080 we would need to add an additional <strong>label</strong> with</p><ul><li><strong>key</strong> = <code>traefik.http.services.wordpress.loadbalancer.server.port</code></li><li><strong>value</strong> = 8080</li></ul></div><div class=post__footer><span><a class=tag href=/tags/docker/>docker</a><a class=tag href=/tags/traefik/>traefik</a><a class=tag href=/tags/unraid/>unraid</a><a class=tag href=/tags/reverse-proxy/>reverse proxy</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
DaTosh
2024</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></body></html>