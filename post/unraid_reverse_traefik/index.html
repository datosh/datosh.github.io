<!doctype html><html dir=ltr lang=en data-theme><head>
<title>
DaTosh
|
Traefik 2 as Docker Reverse Proxy on unRAID
</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.91.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name=description content="
      Setting up Traefik 2.x as Reverse Proxy for Docker Containers on unRAID 6.8.x


    ">
<link rel=stylesheet href=/css/main.min.b614bfbee6b9182d830a0136e1ae95be7cf591865c7e8d4295fb704e26229c8c.css integrity="sha256-thS/vua5GC2DCgE24a6Vvnz1kYZcfo1ClftwTiYinIw=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=/css/markupHighlight.min.058b31f17db60602cc415fd63b0427e7932fbf35c70d8e341a4c39385f5f6f3e.css integrity="sha256-BYsx8X22BgLMQV/WOwQn55MvvzXHDY40Gkw5OF9fbz4=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous>
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=canonical href=/post/unraid_reverse_traefik/>
<script type=text/javascript src=/js/anatole-header.min.2a2cd9614b7d007dfbb75e8da19e3a0fa872ceab53c6d000c00b7a0c89b85bfc.js integrity="sha256-KizZYUt9AH37t16NoZ46D6hyzqtTxtAAwAt6DIm4W/w=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.7fd87181cdd7e8413aa64b6867bb32f3a8dc242e684fc7d5bbb9f600dbc2b6eb.js integrity="sha256-f9hxgc3X6EE6pktoZ7sy86jcJC5oT8fVu7n2ANvCtus=" crossorigin=anonymous></script>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Traefik 2 as Docker Reverse Proxy on unRAID">
<meta name=twitter:description content="Setting up Traefik 2.x as Reverse Proxy for Docker Containers on unRAID 6.8.x">
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"post","name":"Traefik 2 as Docker Reverse Proxy on unRAID","headline":"Traefik 2 as Docker Reverse Proxy on unRAID","alternativeHeadline":"","description":"
      Setting up Traefik 2.x as Reverse Proxy for Docker Containers on unRAID 6.8.x


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/datosh.github.io\/post\/unraid_reverse_traefik\/"},"author":{"@type":"Person","name":"DaTosh"},"creator":{"@type":"Person","name":"DaTosh"},"accountablePerson":{"@type":"Person","name":"DaTosh"},"copyrightHolder":{"@type":"Person","name":"DaTosh"},"copyrightYear":"2021","dateCreated":"2021-01-23T15:28:15.00Z","datePublished":"2021-01-23T15:28:15.00Z","dateModified":"2021-01-23T15:28:15.00Z","publisher":{"@type":"Organization","name":"DaTosh","url":"https://datosh.github.io/","logo":{"@type":"ImageObject","url":"https:\/\/datosh.github.io\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/datosh.github.io\/post\/unraid_reverse_traefik\/","wordCount":"518","genre":[],"keywords":["docker","traefik","unraid","reverse proxy"]}</script>
</head>
<body>
<header><div class="page-top
animated fadeInDown">
<a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
</a>
<nav>
<ul class=nav__list id=navMenu>
<div class=nav__links>
<li>
<a href=/ title>Home</a>
</li>
<li>
<a href=/post/ title>Posts</a>
</li>
<li>
<a href=/goinvaders/ title>goinvaders</a>
</li>
</div>
<ul>
<li>
<a class=theme-switch title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a>
</li>
</ul>
</ul>
</nav>
</div>
</header>
<div class=wrapper>
<aside><div class="sidebar
animated fadeInDown">
<div class=sidebar__content>
<div class=logo-title>
<div class=title>
<img src=/images/Profile.jpg alt="profile picture">
<h3 title><a href=/>DaTosh Blog</a></h3>
<div class=description>
<p></p>
</div>
</div>
</div>
<ul class=social-links>
<li>
<a href=https://github.com/datosh rel=me aria-label=GitHub>
<i class="fab fa-github fa-2x" aria-hidden=true></i>
</a>
</li>
<li>
<a href=https://twitter.com/datosh18 rel=me aria-label=twitter>
<i class="fab fa-twitter fa-2x" aria-hidden=true></i>
</a>
</li>
</ul>
</div><footer class="footer footer--sidebar">
<div class=by_farbox>
<ul class=footer__list>
<li class=footer__item>
&copy;
DaTosh
2021
</li>
</ul>
</div>
</footer>
<script type=text/javascript src=/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I=" crossorigin=anonymous></script></div>
</aside>
<main>
<div class=autopagerize_page_element>
<div class=content>
<div class="post
animated fadeInDown">
<div class=post-content>
<div class=post-title>
<h1>Traefik 2 as Docker Reverse Proxy on unRAID</h1>
<div class=info>
<em class="fas fa-calendar-day"></em>
<span class=date>
Sat, Jan 23, 2021
</span>
<em class="fas fa-stopwatch"></em>
<span class=reading-time>3-minute read</span>
</div>
</div><p>Hosting multiple containers on unRAID, and keeping track of their port mappings
can become quite annoying. Using a reverse proxy as a single point of entry
will allow us to hide this from the user, and use easy to remember DNS records
instead.</p>
<p>In this example we will use Traefik 2.x as a reverse proxy on an unRAID 6.8.x
machine, and configure easy access to the unRAID webUI, Traefik dashboard, as
well as an example Wordpress container, to show how traffic can be routed to
any container running on unRAID.</p>
<h2 id=configure-dns-records>Configure DNS Records</h2>
<p>First we need to create three DNS records, all pointing to the box unRAID is
running on. In this example we assume the TLD <code>home</code>, and unRAID
running on <code>192.168.1.10</code>.</p>
<ul>
<li><code>unraid.home</code> → <code>192.168.1.10</code></li>
<li><code>traefik.home</code> → <code>192.168.1.10</code></li>
<li><code>wordpress.home</code> → <code>192.168.1.10</code></li>
</ul>
<p>How and where to configure these depends on the DNS server you are using.</p>
<h2 id=reconfigure-unraids-http-port>Reconfigure unRAID&rsquo;s HTTP Port</h2>
<p>Traefik will be listening on port <code>80</code> and we need to free up this port,
since unRAID&rsquo;s WebUI will be using it by default.</p>
<p>Go to <code>Settings → Management Access</code>, and change <code>HTTP port</code>.
Here we will be using <code>HTTP port: 8085</code>.</p>
<p><strong>In case your Traefik container is broken, you can always access your
unRAID server at <code>http://192.168.1.10:8085</code>.</strong></p>
<h2 id=prepare-traefik-configuration>Prepare Traefik Configuration</h2>
<p>In order to configure Trafik we will be using a mix of dynamic configuration
(via Docker labels), and static configuration (via configuration files).</p>
<p>Place the following configuration files in your <code>appdata</code> share.</p>
<p><strong><code>appdata/traefik/traefik.yml</code></strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#204a87;font-weight:700>api</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>dashboard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>insecure</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>entryPoints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;:80&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>providers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>docker</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>filename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/traefik/dynamic_conf.yml</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>watch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p><strong><code>appdata/traefik/dynamic_conf.yml</code></strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>routers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>unraid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>entryPoints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>http</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>service</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>unraid</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>rule</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Host(`unraid.home`)&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>unraid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>loadBalancer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>servers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;http://192.168.1.10:8085/&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h2 id=launch-traefik-container>Launch Traefik Container</h2>
<p>Now we can launch the actual Traefik container. Go to the <code>Docker</code> tab
in unRAID and <code>ADD CONTAINER</code>.<br>
We need to fill in the following configuration:</p>
<p>Name: <code>traefik</code><br>
Repository: <code>traefik:latest</code><br>
Network Type: <code>bridge</code></p>
<p>Add a <strong>port</strong> mapping from <code>80 → 80</code>, so that Traefik can listen for incoming
HTTP traffic.</p>
<p>Add a <strong>path</strong> where we mount our <code>/mnt/user/appdata/traefik</code> to <code>/etc/traefik</code>
so that Traefik can actually read our configuration.</p>
<p>Add another <strong>path</strong> where we mount our Docker socket <code>/var/run/docker.sock</code>
to <code>/var/run/docker.sock</code>. <strong>Read-only</strong> is sufficient here. This is required
so Traefik can listed for new containers and read their labels, which is used
for the dynamic configuration part. We are using this exact mechanism to expose
the Treafik dashboard now.</p>
<p>Add a <strong>label</strong></p>
<ul>
<li><strong>key</strong> = <code>traefik.http.routers.api.entrypoints</code></li>
<li><strong>value</strong> = <code>http</code></li>
</ul>
<p>Add another <strong>label</strong></p>
<ul>
<li><strong>key</strong> = <code>traefik.http.routers.api.service</code></li>
<li><strong>value</strong> = <code>api@internal</code></li>
</ul>
<p>And a final <strong>label</strong></p>
<ul>
<li><strong>key</strong> = <code>traefik.http.routers.api.rule</code></li>
<li><strong>value</strong> = Host(`traefik.home`)</li>
</ul>
<p>Your container configuration should look like
<a href=https://i.imgur.com/206isoD.png>this</a></p>
<p>After creating the container you are now able to access unRAID at
<a href=http://unraid.home>http://unraid.home</a>, and the
Traefik dashboard at <a href=http://traefik.home>http://traefik.home</a>.</p>
<h2 id=proxying-any-container>Proxying any Container</h2>
<p>In order to add another container to our Traefik configuration we simply need
to add a single label to it.</p>
<p>Assuming we have a Wordpress container running we can add a <strong>label</strong> with</p>
<ul>
<li><strong>key</strong> = <code>traefik.http.routers.wordpress.rule</code></li>
<li><strong>value</strong> = Host(`wordpress.home`)</li>
</ul>
<p>If our container is only exposing a single port,
<a href=https://doc.traefik.io/traefik/providers/docker/#port-detection>Traefik is smart enough to pick it up,</a>
and no other configuration is required.</p>
<p>If our Wordpress container would expose multiple ports, but the webUI is
accessible on port 8080 we would need to add an additional <strong>label</strong> with</p>
<ul>
<li><strong>key</strong> = <code>traefik.http.services.wordpress.loadbalancer.server.port</code></li>
<li><strong>value</strong> = 8080</li>
</ul>
</div>
<div class=post-footer>
<div class=info>
<span class=separator><a class=tag href=/tags/docker/>docker</a><a class=tag href=/tags/traefik/>traefik</a><a class=tag href=/tags/unraid/>unraid</a><a class=tag href=/tags/reverse-proxy/>reverse proxy</a></span>
</div>
</div>
</div>
</div>
</div>
</main>
</div><footer class="footer footer--base">
<div class=by_farbox>
<ul class=footer__list>
<li class=footer__item>
&copy;
DaTosh
2021
</li>
</ul>
</div>
</footer>
<script type=text/javascript src=/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I=" crossorigin=anonymous></script></body>
</html>